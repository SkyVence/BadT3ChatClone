anthropic=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




I want you to rework the way my chat works in the background.

Currently it create a thread on page load and on submit.
So here is how i want it to work :

When the user click on submit, if a threadId is not provided then it create a new thread and create a new message linked to this thread with the user prompt then it make the request using ai sdk core.
If a threadId is provided, it create a new message linked to the thread with the user prompt then it gets all the messages linked to the thread and create a threadMessages object and it map all the threads messages with the role and message. make sure the messages are in order.


Implement also the links in the sidebar to existing threads.
Also when the user send a message with no threadId and it create a new thread, the sidebar should update with the new thread and it should show in the link the /chat/<threadId> as the active link without a full page reload to keep the stream working.